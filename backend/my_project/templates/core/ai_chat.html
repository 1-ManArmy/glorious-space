{% extends 'base.html' %}
{% load static %}

{% block title %}AI Assistant - Your Personal Coding Companion{% endblock %}

{% block extra_css %}
<style>
    .ai-chat-container {
        height: 100vh;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        position: relative;
        overflow: hidden;
    }
    
    .ai-chat-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="ai-pattern" width="30" height="30" patternUnits="userSpaceOnUse"><circle cx="15" cy="15" r="2" fill="rgba(255,255,255,0.1)"/><path d="M10 10h10v10h-10z" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23ai-pattern)"/></svg>');
        animation: aiFloat 25s ease-in-out infinite;
    }
    
    @keyframes aiFloat {
        0%, 100% { transform: translateX(0) translateY(0); }
        25% { transform: translateX(-10px) translateY(-15px); }
        50% { transform: translateX(10px) translateY(-10px); }
        75% { transform: translateX(-5px) translateY(15px); }
    }
    
    .ai-sidebar {
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(20px);
        height: 100vh;
        border-right: 1px solid rgba(255,255,255,0.2);
        display: flex;
        flex-direction: column;
        position: relative;
        z-index: 10;
    }
    
    .ai-header {
        padding: 25px;
        background: rgba(255,255,255,0.1);
        border-bottom: 1px solid rgba(255,255,255,0.2);
        text-align: center;
        color: white;
    }
    
    .ai-logo {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        50% { transform: scale(1.05); box-shadow: 0 15px 40px rgba(0,0,0,0.4); }
    }
    
    .ai-logo i {
        font-size: 1.8rem;
        color: white;
    }
    
    .ai-title {
        font-size: 1.4rem;
        font-weight: bold;
        margin: 0 0 5px 0;
    }
    
    .ai-subtitle {
        font-size: 0.9rem;
        opacity: 0.8;
        margin: 0;
    }
    
    .ai-features {
        flex: 1;
        padding: 20px;
        overflow-y: auto;
    }
    
    .feature-section {
        margin-bottom: 25px;
    }
    
    .feature-title {
        font-size: 0.9rem;
        font-weight: 600;
        color: #495057;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        margin-bottom: 12px;
        padding-bottom: 5px;
        border-bottom: 2px solid #e9ecef;
    }
    
    .feature-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 8px;
        border: 1px solid transparent;
    }
    
    .feature-item:hover,
    .feature-item.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    .feature-icon {
        width: 35px;
        height: 35px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: #f8f9fa;
        color: #667eea;
        font-size: 1rem;
    }
    
    .feature-item:hover .feature-icon,
    .feature-item.active .feature-icon {
        background: rgba(255,255,255,0.2);
        color: white;
    }
    
    .feature-info {
        flex: 1;
    }
    
    .feature-name {
        font-weight: 600;
        margin: 0 0 2px 0;
        font-size: 0.9rem;
    }
    
    .feature-desc {
        font-size: 0.75rem;
        opacity: 0.7;
        margin: 0;
    }
    
    .ai-stats {
        padding: 20px;
        background: rgba(255,255,255,0.1);
        border-top: 1px solid rgba(255,255,255,0.2);
    }
    
    .stat-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }
    
    .stat-item {
        text-align: center;
        color: white;
    }
    
    .stat-number {
        font-size: 1.5rem;
        font-weight: bold;
        display: block;
        color: #ffc107;
    }
    
    .stat-label {
        font-size: 0.7rem;
        opacity: 0.8;
    }
    
    .ai-main {
        display: flex;
        flex-direction: column;
        height: 100vh;
        background: white;
        position: relative;
        z-index: 10;
    }
    
    .ai-top-bar {
        padding: 20px 25px;
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid #e9ecef;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }
    
    .current-mode {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .mode-icon {
        width: 45px;
        height: 45px;
        border-radius: 12px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.3rem;
    }
    
    .mode-info h4 {
        margin: 0;
        color: #333;
        font-weight: 600;
    }
    
    .mode-status {
        font-size: 0.85rem;
        color: #28a745;
        margin: 2px 0 0 0;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .ai-controls {
        display: flex;
        gap: 10px;
    }
    
    .control-btn {
        width: 40px;
        height: 40px;
        border-radius: 10px;
        border: 1px solid #e9ecef;
        background: white;
        color: #6c757d;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .control-btn:hover {
        background: #667eea;
        color: white;
        border-color: #667eea;
        transform: translateY(-2px);
    }
    
    .ai-messages {
        flex: 1;
        overflow-y: auto;
        padding: 25px;
        background: #f8f9fa;
        display: flex;
        flex-direction: column;
        gap: 25px;
    }
    
    .ai-message {
        display: flex;
        gap: 15px;
        animation: messageAppear 0.5s ease;
    }
    
    .ai-message.user {
        flex-direction: row-reverse;
    }
    
    @keyframes messageAppear {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .message-avatar {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 3px solid white;
        box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        position: relative;
    }
    
    .message-avatar.ai {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
    }
    
    .message-avatar.user img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 50%;
    }
    
    .thinking-indicator {
        position: absolute;
        top: -5px;
        right: -5px;
        width: 15px;
        height: 15px;
        background: #ffc107;
        border: 2px solid white;
        border-radius: 50%;
        animation: thinking 1s infinite;
    }
    
    @keyframes thinking {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.2); }
    }
    
    .message-content {
        max-width: 75%;
        display: flex;
        flex-direction: column;
    }
    
    .ai-message.user .message-content {
        align-items: flex-end;
    }
    
    .message-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 8px;
    }
    
    .ai-message.user .message-header {
        flex-direction: row-reverse;
    }
    
    .message-author {
        font-weight: 600;
        color: #333;
        font-size: 0.9rem;
    }
    
    .message-time {
        color: #6c757d;
        font-size: 0.75rem;
    }
    
    .message-bubble {
        background: white;
        padding: 18px 22px;
        border-radius: 20px;
        box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        position: relative;
        word-wrap: break-word;
        line-height: 1.6;
    }
    
    .ai-message.user .message-bubble {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }
    
    .message-bubble::before {
        content: '';
        position: absolute;
        top: 12px;
        left: -8px;
        width: 0;
        height: 0;
        border-top: 8px solid transparent;
        border-bottom: 8px solid transparent;
        border-right: 8px solid white;
    }
    
    .ai-message.user .message-bubble::before {
        left: auto;
        right: -8px;
        border-right: none;
        border-left: 8px solid #667eea;
    }
    
    .code-block {
        background: #2d3748;
        color: #e2e8f0;
        border-radius: 8px;
        padding: 15px;
        margin: 10px 0;
        font-family: 'Courier New', monospace;
        font-size: 0.85rem;
        overflow-x: auto;
    }
    
    .code-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 10px;
        padding-bottom: 8px;
        border-bottom: 1px solid #4a5568;
    }
    
    .code-language {
        color: #38b2ac;
        font-weight: 600;
        font-size: 0.8rem;
    }
    
    .copy-code {
        background: #38b2ac;
        color: white;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 0.7rem;
        cursor: pointer;
    }
    
    .ai-suggestions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 12px;
    }
    
    .suggestion-chip {
        background: rgba(102, 126, 234, 0.1);
        color: #667eea;
        padding: 6px 12px;
        border-radius: 15px;
        font-size: 0.8rem;
        cursor: pointer;
        transition: all 0.3s ease;
        border: 1px solid rgba(102, 126, 234, 0.2);
    }
    
    .suggestion-chip:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
    }
    
    .voice-input {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255,255,255,0.95);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 40px;
        text-align: center;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        z-index: 1000;
        display: none;
    }
    
    .voice-input.active {
        display: block;
        animation: voiceAppear 0.4s ease;
    }
    
    @keyframes voiceAppear {
        from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }
    
    .voice-animation {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto 20px;
        position: relative;
        animation: voicePulse 2s infinite;
    }
    
    @keyframes voicePulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }
    
    .voice-animation::before {
        content: '';
        position: absolute;
        top: -20px;
        left: -20px;
        right: -20px;
        bottom: -20px;
        border: 3px solid #667eea;
        border-radius: 50%;
        opacity: 0.3;
        animation: voiceRing 2s infinite;
    }
    
    @keyframes voiceRing {
        0% { transform: scale(0.8); opacity: 0.7; }
        100% { transform: scale(1.2); opacity: 0; }
    }
    
    .voice-animation i {
        font-size: 2.5rem;
        color: white;
    }
    
    .ai-input-container {
        padding: 20px 25px;
        background: white;
        border-top: 1px solid #e9ecef;
    }
    
    .ai-input-wrapper {
        display: flex;
        gap: 15px;
        align-items: flex-end;
        position: relative;
    }
    
    .input-tools {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .input-tool {
        width: 35px;
        height: 35px;
        border-radius: 8px;
        border: 1px solid #e9ecef;
        background: white;
        color: #6c757d;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .input-tool:hover,
    .input-tool.active {
        background: #667eea;
        color: white;
        border-color: #667eea;
    }
    
    .ai-input {
        flex: 1;
        min-height: 50px;
        max-height: 150px;
        border: 2px solid #e9ecef;
        border-radius: 25px;
        padding: 15px 25px;
        resize: none;
        font-family: inherit;
        font-size: 1rem;
        line-height: 1.5;
        transition: all 0.3s ease;
    }
    
    .ai-input:focus {
        border-color: #667eea;
        box-shadow: 0 0 25px rgba(102, 126, 234, 0.2);
        outline: none;
    }
    
    .send-ai {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border: none;
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }
    
    .send-ai:hover {
        transform: scale(1.1);
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    .send-ai:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
    }
    
    .quick-prompts {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 15px;
    }
    
    .quick-prompt {
        background: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 20px;
        padding: 8px 15px;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.3s ease;
        color: #495057;
    }
    
    .quick-prompt:hover {
        background: #667eea;
        color: white;
        border-color: #667eea;
        transform: translateY(-2px);
    }
    
    @media (max-width: 768px) {
        .ai-sidebar {
            position: absolute;
            left: -100%;
            width: 280px;
            z-index: 1000;
            transition: left 0.3s ease;
        }
        
        .ai-sidebar.show {
            left: 0;
        }
        
        .message-content {
            max-width: 90%;
        }
        
        .ai-input-wrapper {
            flex-direction: column;
            gap: 10px;
        }
        
        .input-tools {
            flex-direction: row;
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <div class="row g-0 ai-chat-container">
        <!-- AI Sidebar -->
        <div class="col-lg-3 col-md-4">
            <div class="ai-sidebar" id="aiSidebar">
                <!-- AI Header -->
                <div class="ai-header">
                    <div class="ai-logo">
                        <i class="fas fa-brain"></i>
                    </div>
                    <h3 class="ai-title">Claude AI</h3>
                    <p class="ai-subtitle">Your Intelligent Coding Assistant</p>
                </div>
                
                <!-- AI Features -->
                <div class="ai-features">
                    <div class="feature-section">
                        <h6 class="feature-title">AI Capabilities</h6>
                        
                        <div class="feature-item active" data-mode="general">
                            <div class="feature-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <div class="feature-info">
                                <h6 class="feature-name">General Chat</h6>
                                <p class="feature-desc">Ask anything, get intelligent responses</p>
                            </div>
                        </div>
                        
                        <div class="feature-item" data-mode="code">
                            <div class="feature-icon">
                                <i class="fas fa-code"></i>
                            </div>
                            <div class="feature-info">
                                <h6 class="feature-name">Code Assistant</h6>
                                <p class="feature-desc">Write, debug, and optimize code</p>
                            </div>
                        </div>
                        
                        <div class="feature-item" data-mode="explain">
                            <div class="feature-icon">
                                <i class="fas fa-lightbulb"></i>
                            </div>
                            <div class="feature-info">
                                <h6 class="feature-name">Code Explanation</h6>
                                <p class="feature-desc">Understand complex algorithms</p>
                            </div>
                        </div>
                        
                        <div class="feature-item" data-mode="debug">
                            <div class="feature-icon">
                                <i class="fas fa-bug"></i>
                            </div>
                            <div class="feature-info">
                                <h6 class="feature-name">Debug Helper</h6>
                                <p class="feature-desc">Find and fix code issues</p>
                            </div>
                        </div>
                        
                        <div class="feature-item" data-mode="review">
                            <div class="feature-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="feature-info">
                                <h6 class="feature-name">Code Review</h6>
                                <p class="feature-desc">Get feedback and improvements</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="feature-section">
                        <h6 class="feature-title">Advanced Features</h6>
                        
                        <div class="feature-item" data-mode="ai-training">
                            <div class="feature-icon">
                                <i class="fas fa-graduation-cap"></i>
                            </div>
                            <div class="feature-info">
                                <h6 class="feature-name">AI Training</h6>
                                <p class="feature-desc">Learn machine learning concepts</p>
                            </div>
                        </div>
                        
                        <div class="feature-item" data-mode="web3">
                            <div class="feature-icon">
                                <i class="fab fa-ethereum"></i>
                            </div>
                            <div class="feature-info">
                                <h6 class="feature-name">Web3 Expert</h6>
                                <p class="feature-desc">Blockchain and smart contracts</p>
                            </div>
                        </div>
                        
                        <div class="feature-item" data-mode="canvas">
                            <div class="feature-icon">
                                <i class="fas fa-palette"></i>
                            </div>
                            <div class="feature-info">
                                <h6 class="feature-name">Canvas & 3D</h6>
                                <p class="feature-desc">Graphics programming help</p>
                            </div>
                        </div>
                        
                        <div class="feature-item" data-mode="architecture">
                            <div class="feature-icon">
                                <i class="fas fa-sitemap"></i>
                            </div>
                            <div class="feature-info">
                                <h6 class="feature-name">Architecture</h6>
                                <p class="feature-desc">System design and patterns</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- AI Stats -->
                <div class="ai-stats">
                    <div class="stat-grid">
                        <div class="stat-item">
                            <span class="stat-number">24/7</span>
                            <span class="stat-label">Available</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">∞</span>
                            <span class="stat-label">Knowledge</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">0ms</span>
                            <span class="stat-label">Lag Time</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-number">100%</span>
                            <span class="stat-label">Accurate</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Main -->
        <div class="col-lg-9 col-md-8">
            <div class="ai-main">
                <!-- AI Top Bar -->
                <div class="ai-top-bar">
                    <div class="current-mode">
                        <div class="mode-icon">
                            <i class="fas fa-comments"></i>
                        </div>
                        <div class="mode-info">
                            <h4 id="currentModeName">General Assistant</h4>
                            <p class="mode-status">
                                <i class="fas fa-circle text-success"></i>
                                Ready to help • Voice & Text enabled
                            </p>
                        </div>
                    </div>
                    <div class="ai-controls">
                        <button class="control-btn" id="voiceToggle" title="Voice Input">
                            <i class="fas fa-microphone"></i>
                        </button>
                        <button class="control-btn" id="settingsBtn" title="AI Settings">
                            <i class="fas fa-cog"></i>
                        </button>
                        <button class="control-btn" id="historyBtn" title="Chat History">
                            <i class="fas fa-history"></i>
                        </button>
                        <button class="control-btn" id="clearBtn" title="Clear Chat">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
                
                <!-- AI Messages -->
                <div class="ai-messages" id="aiMessages">
                    <!-- Welcome Message -->
                    <div class="ai-message">
                        <div class="message-avatar ai">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div class="message-content">
                            <div class="message-header">
                                <span class="message-author">Claude AI</span>
                                <span class="message-time">Just now</span>
                            </div>
                            <div class="message-bubble">
                                👋 Hello! I'm Claude, your intelligent coding assistant. I'm here to help you with:
                                
                                <br><br><strong>🎯 What I can do:</strong>
                                <br>• Write and debug code in any language
                                <br>• Explain complex algorithms and concepts  
                                <br>• Review and optimize your code
                                <br>• Help with AI/ML, Web3, Canvas, and more
                                <br>• Voice interaction for hands-free coding
                                <br>• Real-time collaboration and learning
                                
                                <br><br>🚀 Try asking me anything or use voice input!
                                
                                <div class="ai-suggestions">
                                    <span class="suggestion-chip">Help me debug Python code</span>
                                    <span class="suggestion-chip">Explain React hooks</span>
                                    <span class="suggestion-chip">Create a neural network</span>
                                    <span class="suggestion-chip">Build a Web3 dApp</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Voice Input Modal -->
                <div class="voice-input" id="voiceInput">
                    <div class="voice-animation">
                        <i class="fas fa-microphone"></i>
                    </div>
                    <h4>Listening...</h4>
                    <p>Speak clearly and I'll help you with your request</p>
                    <button class="btn btn-outline-primary" id="stopVoice">Stop Listening</button>
                </div>
                
                <!-- AI Input -->
                <div class="ai-input-container">
                    <!-- Quick Prompts -->
                    <div class="quick-prompts">
                        <span class="quick-prompt">Explain this code</span>
                        <span class="quick-prompt">Find bugs in my function</span>
                        <span class="quick-prompt">Optimize performance</span>
                        <span class="quick-prompt">Add error handling</span>
                        <span class="quick-prompt">Create unit tests</span>
                        <span class="quick-prompt">Convert to TypeScript</span>
                    </div>
                    
                    <div class="ai-input-wrapper">
                        <div class="input-tools">
                            <button class="input-tool" id="codeMode" title="Code Mode">
                                <i class="fas fa-code"></i>
                            </button>
                            <button class="input-tool" id="fileUpload" title="Upload File">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <button class="input-tool" id="imageAnalysis" title="Image Analysis">
                                <i class="fas fa-image"></i>
                            </button>
                            <button class="input-tool" id="voiceInput" title="Voice Input">
                                <i class="fas fa-microphone"></i>
                            </button>
                        </div>
                        <textarea 
                            class="ai-input" 
                            id="aiInput" 
                            placeholder="Ask me anything about coding, AI, Web3, or any technical topic... (Shift+Enter for new line)"
                            rows="1"></textarea>
                        <button class="send-ai" id="sendAI" disabled>
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const aiInput = document.getElementById('aiInput');
    const sendBtn = document.getElementById('sendAI');
    const aiMessages = document.getElementById('aiMessages');
    const voiceInputModal = document.getElementById('voiceInput');
    const voiceToggle = document.getElementById('voiceToggle');
    const featureItems = document.querySelectorAll('.feature-item');
    const quickPrompts = document.querySelectorAll('.quick-prompt');
    const suggestionChips = document.querySelectorAll('.suggestion-chip');
    const inputTools = document.querySelectorAll('.input-tool');
    
    // Current AI mode
    let currentMode = 'general';
    let isVoiceActive = false;
    
    // Auto-resize textarea
    aiInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = Math.min(this.scrollHeight, 150) + 'px';
        
        // Enable/disable send button
        sendBtn.disabled = this.value.trim() === '';
    });
    
    // Feature/Mode selection
    featureItems.forEach(item => {
        item.addEventListener('click', function() {
            featureItems.forEach(f => f.classList.remove('active'));
            this.classList.add('active');
            
            currentMode = this.dataset.mode;
            const modeName = this.querySelector('.feature-name').textContent;
            const modeIcon = this.querySelector('.feature-icon i').className;
            
            // Update top bar
            document.getElementById('currentModeName').textContent = modeName;
            document.querySelector('.mode-icon i').className = modeIcon;
            
            // Add mode switch message
            addAIMessage(`🔄 Switched to ${modeName} mode. I'm now specialized to help you with this area!`);
        });
    });
    
    // Send message function
    function sendMessage(userMessage) {
        if (!userMessage.trim()) return;
        
        // Add user message
        addUserMessage(userMessage);
        
        // Clear input
        aiInput.value = '';
        aiInput.style.height = 'auto';
        sendBtn.disabled = true;
        
        // Show AI thinking and respond
        setTimeout(() => {
            const response = generateAIResponse(userMessage, currentMode);
            addAIMessage(response);
        }, 1000);
    }
    
    // Add user message
    function addUserMessage(message) {
        const messageDiv = document.createElement('div');
        messageDiv.className = 'ai-message user';
        messageDiv.innerHTML = `
            <div class="message-avatar user">
                <img src="/static/img/user-profile.jpg" alt="You">
            </div>
            <div class="message-content">
                <div class="message-header">
                    <span class="message-author">You</span>
                    <span class="message-time">Just now</span>
                </div>
                <div class="message-bubble">
                    ${message.replace(/\n/g, '<br>')}
                </div>
            </div>
        `;
        
        aiMessages.appendChild(messageDiv);
        scrollToBottom();
    }
    
    // Add AI message
    function addAIMessage(message, showThinking = true) {
        if (showThinking) {
            // Show thinking indicator
            const thinkingDiv = document.createElement('div');
            thinkingDiv.className = 'ai-message';
            thinkingDiv.id = 'thinking';
            thinkingDiv.innerHTML = `
                <div class="message-avatar ai">
                    <i class="fas fa-brain"></i>
                    <div class="thinking-indicator"></div>
                </div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-author">Claude AI</span>
                        <span class="message-time">Thinking...</span>
                    </div>
                    <div class="message-bubble">
                        <i class="fas fa-spinner fa-spin"></i> Analyzing your request...
                    </div>
                </div>
            `;
            
            aiMessages.appendChild(thinkingDiv);
            scrollToBottom();
            
            // Remove thinking indicator after delay
            setTimeout(() => {
                const thinking = document.getElementById('thinking');
                if (thinking) thinking.remove();
                
                // Add actual AI response
                const messageDiv = document.createElement('div');
                messageDiv.className = 'ai-message';
                messageDiv.innerHTML = `
                    <div class="message-avatar ai">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="message-content">
                        <div class="message-header">
                            <span class="message-author">Claude AI</span>
                            <span class="message-time">Just now</span>
                        </div>
                        <div class="message-bubble">
                            ${message}
                        </div>
                    </div>
                `;
                
                aiMessages.appendChild(messageDiv);
                scrollToBottom();
            }, 1500);
        } else {
            // Add immediate message
            const messageDiv = document.createElement('div');
            messageDiv.className = 'ai-message';
            messageDiv.innerHTML = `
                <div class="message-avatar ai">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="message-content">
                    <div class="message-header">
                        <span class="message-author">Claude AI</span>
                        <span class="message-time">Just now</span>
                    </div>
                    <div class="message-bubble">
                        ${message}
                    </div>
                </div>
            `;
            
            aiMessages.appendChild(messageDiv);
            scrollToBottom();
        }
    }
    
    // Generate AI response based on mode and input
    function generateAIResponse(userMessage, mode) {
        const message = userMessage.toLowerCase();
        
        // Code-related responses
        if (mode === 'code' || message.includes('code') || message.includes('function') || message.includes('debug')) {
            return `🔧 <strong>Code Analysis Complete!</strong><br><br>
                    I can help you with that code issue. Here's what I recommend:<br><br>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">Python</span>
                            <button class="copy-code">Copy</button>
                        </div>
                        <pre>def optimized_function(data):<br>    """Optimized version with error handling"""<br>    try:<br>        return [x * 2 for x in data if x > 0]<br>    except TypeError:<br>        return []</pre>
                    </div>
                    
                    <strong>Key improvements:</strong><br>
                    • Added error handling for robust execution<br>
                    • Used list comprehension for better performance<br>
                    • Added type validation<br><br>
                    
                    Would you like me to explain any part in detail? 🚀`;
        }
        
        // AI/ML responses
        if (mode === 'ai-training' || message.includes('ai') || message.includes('neural') || message.includes('machine learning')) {
            return `🧠 <strong>AI/ML Expert Mode Activated!</strong><br><br>
                    Great question about artificial intelligence! Here's what I can explain:<br><br>
                    
                    <strong>🎯 Neural Network Basics:</strong><br>
                    • Input Layer → Hidden Layers → Output Layer<br>
                    • Backpropagation for learning<br>
                    • Activation functions (ReLU, Sigmoid, Tanh)<br><br>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">Python (TensorFlow)</span>
                            <button class="copy-code">Copy</button>
                        </div>
                        <pre>import tensorflow as tf<br><br>model = tf.keras.Sequential([<br>    tf.keras.layers.Dense(128, activation='relu'),<br>    tf.keras.layers.Dropout(0.2),<br>    tf.keras.layers.Dense(10, activation='softmax')<br>])</pre>
                    </div>
                    
                    Want to dive deeper into specific algorithms or build a custom model? 🤖`;
        }
        
        // Web3 responses
        if (mode === 'web3' || message.includes('web3') || message.includes('blockchain') || message.includes('smart contract')) {
            return `⛓️ <strong>Web3 Blockchain Expert!</strong><br><br>
                    Excellent! Let's explore the decentralized world together:<br><br>
                    
                    <strong>🔗 Smart Contract Development:</strong><br>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">Solidity</span>
                            <button class="copy-code">Copy</button>
                        </div>
                        <pre>pragma solidity ^0.8.0;<br><br>contract MyToken {<br>    mapping(address => uint256) public balances;<br>    <br>    function transfer(address to, uint256 amount) public {<br>        require(balances[msg.sender] >= amount);<br>        balances[msg.sender] -= amount;<br>        balances[to] += amount;<br>    }<br>}</pre>
                    </div>
                    
                    <strong>Key Concepts:</strong><br>
                    • DeFi protocols and yield farming<br>
                    • NFT marketplace development<br>
                    • Cross-chain interoperability<br>
                    • Gas optimization techniques<br><br>
                    
                    Ready to build the next DeFi protocol? 🚀`;
        }
        
        // Canvas/3D responses
        if (mode === 'canvas' || message.includes('canvas') || message.includes('3d') || message.includes('webgl')) {
            return `🎨 <strong>Canvas & 3D Graphics Specialist!</strong><br><br>
                    Let's create something visually stunning:<br><br>
                    
                    <div class="code-block">
                        <div class="code-header">
                            <span class="code-language">JavaScript (Three.js)</span>
                            <button class="copy-code">Copy</button>
                        </div>
                        <pre>const scene = new THREE.Scene();<br>const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight);<br>const renderer = new THREE.WebGLRenderer();<br><br>// Create a rotating cube<br>const geometry = new THREE.BoxGeometry();<br>const material = new THREE.MeshBasicMaterial({color: 0x00ff00});<br>const cube = new THREE.Mesh(geometry, material);<br>scene.add(cube);</pre>
                    </div>
                    
                    <strong>🌟 Advanced Techniques:</strong><br>
                    • Particle systems and physics<br>
                    • Shader programming (GLSL)<br>
                    • VR/AR integration with WebXR<br>
                    • Real-time ray tracing<br><br>
                    
                    Want to build an immersive 3D experience? ✨`;
        }
        
        // Debug mode responses
        if (mode === 'debug' || message.includes('bug') || message.includes('error') || message.includes('fix')) {
            return `🐛 <strong>Debug Detective Mode!</strong><br><br>
                    I'll help you hunt down those pesky bugs:<br><br>
                    
                    <strong>🔍 Common Issues I Can Fix:</strong><br>
                    • Syntax and runtime errors<br>
                    • Memory leaks and performance issues<br>
                    • Logic errors and edge cases<br>
                    • API integration problems<br><br>
                    
                    <strong>📋 Debugging Strategy:</strong><br>
                    1. Reproduce the issue consistently<br>
                    2. Add logging and breakpoints<br>
                    3. Isolate the problematic code<br>
                    4. Test edge cases thoroughly<br><br>
                    
                    Share your error message or problematic code, and I'll provide a detailed analysis! 🔧`;
        }
        
        // General responses
        const generalResponses = [
            `🤖 <strong>I'm here to help!</strong><br><br>
             That's a great question! I can assist you with any technical challenge. Whether it's:<br><br>
             • Writing efficient algorithms<br>
             • Debugging complex issues<br>
             • Learning new technologies<br>
             • Building scalable applications<br><br>
             Feel free to be more specific about what you'd like to work on! 🚀`,
             
            `💡 <strong>Excellent question!</strong><br><br>
             I love helping developers solve problems! Here are some ways I can assist:<br><br>
             <strong>🎯 Immediate Help:</strong><br>
             • Code review and optimization<br>
             • Architecture recommendations<br>
             • Best practices guidance<br>
             • Technology comparisons<br><br>
             What specific challenge can I help you tackle today? ⚡`,
             
            `🌟 <strong>Let's build something amazing!</strong><br><br>
             As your AI coding companion, I'm equipped with knowledge across:<br><br>
             • Modern web frameworks (React, Vue, Angular)<br>
             • Backend technologies (Node.js, Python, Go)<br>
             • Mobile development (React Native, Flutter)<br>
             • Cloud platforms (AWS, Azure, GCP)<br>
             • DevOps and CI/CD pipelines<br><br>
             What project are you working on? I'm excited to help! 🚀`
        ];
        
        return generalResponses[Math.floor(Math.random() * generalResponses.length)];
    }
    
    // Quick prompts
    quickPrompts.forEach(prompt => {
        prompt.addEventListener('click', function() {
            aiInput.value = this.textContent;
            aiInput.dispatchEvent(new Event('input'));
            aiInput.focus();
        });
    });
    
    // Suggestion chips
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('suggestion-chip')) {
            const suggestion = e.target.textContent;
            sendMessage(suggestion);
        }
    });
    
    // Input tools
    inputTools.forEach(tool => {
        tool.addEventListener('click', function() {
            const toolId = this.id;
            
            if (toolId === 'codeMode') {
                this.classList.toggle('active');
                if (this.classList.contains('active')) {
                    aiInput.placeholder = "Enter your code or describe the programming problem...";
                } else {
                    aiInput.placeholder = "Ask me anything about coding, AI, Web3, or any technical topic...";
                }
            } else if (toolId === 'fileUpload') {
                alert('📁 File upload feature coming soon! Upload code files, images, and documents for analysis.');
            } else if (toolId === 'imageAnalysis') {
                alert('🖼️ Image analysis coming soon! Upload screenshots of code, diagrams, or UI mockups.');
            } else if (toolId === 'voiceInput') {
                startVoiceInput();
            }
        });
    });
    
    // Voice input functionality
    function startVoiceInput() {
        if (!isVoiceActive) {
            isVoiceActive = true;
            voiceInputModal.classList.add('active');
            
            // Simulate voice recognition
            setTimeout(() => {
                const voiceCommands = [
                    "Create a React component for user authentication",
                    "Help me debug this Python function",
                    "Explain how neural networks work",
                    "Build a smart contract for token trading",
                    "Optimize this CSS animation"
                ];
                
                const randomCommand = voiceCommands[Math.floor(Math.random() * voiceCommands.length)];
                aiInput.value = randomCommand;
                aiInput.dispatchEvent(new Event('input'));
                
                stopVoiceInput();
                setTimeout(() => sendMessage(randomCommand), 500);
            }, 3000);
        }
    }
    
    function stopVoiceInput() {
        isVoiceActive = false;
        voiceInputModal.classList.remove('active');
    }
    
    // Voice controls
    voiceToggle.addEventListener('click', startVoiceInput);
    document.getElementById('stopVoice').addEventListener('click', stopVoiceInput);
    
    // Control buttons
    document.getElementById('settingsBtn').addEventListener('click', function() {
        alert('⚙️ AI Settings: Customize response length, coding style preferences, and more! (Coming soon)');
    });
    
    document.getElementById('historyBtn').addEventListener('click', function() {
        alert('📚 Chat History: View and search through your previous conversations! (Coming soon)');
    });
    
    document.getElementById('clearBtn').addEventListener('click', function() {
        if (confirm('Clear all messages? This action cannot be undone.')) {
            const welcomeMessage = aiMessages.querySelector('.ai-message');
            aiMessages.innerHTML = '';
            aiMessages.appendChild(welcomeMessage);
        }
    });
    
    // Send message
    sendBtn.addEventListener('click', () => sendMessage(aiInput.value));
    
    // Enter key handling
    aiInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage(this.value);
        }
    });
    
    // Copy code functionality
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('copy-code')) {
            const codeBlock = e.target.closest('.code-block').querySelector('pre');
            navigator.clipboard.writeText(codeBlock.textContent);
            e.target.textContent = 'Copied!';
            setTimeout(() => {
                e.target.textContent = 'Copy';
            }, 2000);
        }
    });
    
    // Scroll to bottom
    function scrollToBottom() {
        aiMessages.scrollTop = aiMessages.scrollHeight;
    }
    
    // Initialize
    scrollToBottom();
    aiInput.focus();
});
</script>
{% endblock %}
